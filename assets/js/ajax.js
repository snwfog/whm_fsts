// Generated by CoffeeScript 1.3.3

$(function() {
  var drawRating, noteAlert, recallTime;
  recallTime = 2000;
  setInterval(function() {
    return $.ajax({
      url: "Index.php?ajax&notify_acquire=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert("Your bid \"<b><a href=\"Index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"            just arrived at the garage. You may come and pick it up            during our regular business hour within the next <b>14</b> days.", "success");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "Index.php?ajax&notify_bid=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert(("You received a new bid for your offer            \"<b><a href=\"Index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"            approximately <b>") + moment(item.date, "YYYY-MM-DD hh:mm:ss").add('hours', 1).fromNow() + "</b>.", "success");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "Index.php?ajax&notify_winning_bid=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert(("You just won an offer                      \"<b><a href=\"Index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"                      approximately <b>") + moment(item.date, "YYYY-MM-DD hh:mm:ss").add('hours', 1).fromNow() + "</b>.                      You will be billed accordingly to your bidding offer. Please see your                      credit card transaction history for detail information.", "success");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "Index.php?ajax&notify_expired_bids=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert(("Your bids \"<b><a href=\"Index.php?offer&id=" + item.id + "\">" + item.description + "</a></b>\"          was expired <b>") + moment(item.date, "YYYY-MM-DD hh:mm:ss").add('hours', 1).fromNow() + "</b>.", "warning");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "Index.php?ajax&notify_receive=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert("Hey, we just received your item \"<b><a href=\"Index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"            in our garage. Rest assured as we've already notified            the bidder to come and pick it up.", "success");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "Index.php?ajax&notify_modify=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert("The item \"<b><a href=\"Index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"                      has been modified by the owner.", "warning");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "Index.php?ajax&warn=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert("You received a warning for your post \"<b><a href=\"Index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"", "error");
        });
      }
    });
  }, recallTime);
  $.ajax({
    url: "Index.php?ajax&is_admin=1",
    dataType: "json"
  }).done(function(data) {
    if (data != null) {
      if (data.is_admin != null) {
        return noteAlert("Hey <b>" + data.admin_username + "</b>,          you are now in <b>Rainbow Unicorn Mode</b>            AKA <b>Admin Mode</b>.", "success");
      }
    }
  });
  noteAlert = function(msg, type) {
    var n;
    return n = noty({
      layout: 'bottomRight',
      type: type,
      text: msg,
      animation: {
        open: {
          height: 'toggle'
        },
        close: {
          height: 'toggle'
        },
        easing: 'swing',
        speed: 200
      }
    });
  };
  $('#admin-member-search, #member-name').live('click keyup', function() {
    var evalStr;
    evalStr = "";
    if ($('input[name=order_by]:checked').val()) {
      evalStr += "&order_by=" + $('input[name=order_by]:checked').val();
      if ($('input[name=direction]:checked').val()) {
        evalStr += "&direction=" + $('input[name=direction]:checked').val();
      }
    }
    return $.ajax({
      url: "Index.php?ajax&admin_member_search=" + $('#member-name').val() + evalStr,
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        $('#member-search-table').html("<tr><th>Position</th><th>User</th><th>Posts</th>          <th>Buys</th><th>Sells</th><th>Rating</th></tr>");
        return $.each(data, function(i, item) {
          return $('#member-search-table').append("<tr>" + ("<td>" + (i + 1) + "</td><td><div class='tiptip'>") + "<a href='Index.php?member&id=" + item.id + "' class='button'>" + "<span class='icon icon191'>" + "</span><span class='label'>" + item.username + "</span></a></div></td>" + ("<td>" + item.posts + "</td>") + ("<td>" + item.buys + "</td>") + ("<td>" + item.sells + "</td>") + "<td>" + (item.rating === null ? "No Rating" : drawRating(item.rating) + "</td></tr>"));
        });
      }
    });
  });
  drawRating = function(rating) {
    var i, str, _i;
    str = "<span class='earned-rating'>";
    for (i = _i = 1; 1 <= rating ? _i <= rating : _i >= rating; i = 1 <= rating ? ++_i : --_i) {
      str += "$&nbsp;";
    }
    return str + "</span>";
  };
  $('#admin-category').live('click keyup', function() {
    var evalStr;
    evalStr = "";
    if ($('input[name=order_by]:checked').val()) {
      evalStr += "&order_by=" + $('input[name=order_by]:checked').val();
      if ($('input[name=direction]:checked').val()) {
        evalStr += "&direction=" + $('input[name=direction]:checked').val();
      }
    }
    return $.ajax({
      url: "Index.php?ajax&admin_category=1" + evalStr,
      dataType: "json"
    }).done(function(data) {
      var category, counts, volume;
      if (data != null) {
        $('#volume-graph, #counts-graph').html("");
        category = [];
        volume = [];
        counts = [];
        $.each(data, function(i, item) {
          category.push(item.name);
          volume.push(parseInt(item.volume));
          return counts.push(parseInt(item.counts));
        });
        new Ico.LineGraph($('#volume-graph')[0], {
          one: volume
        }, {
          markers: 'circle',
          colours: {
            one: 'pink'
          },
          labels: category,
          meanline: false,
          grid: true,
          grid_colour: "#EEEEEE",
          stroke_width: "2px"
        });
        return new Ico.LineGraph($('#counts-graph')[0], {
          one: counts
        }, {
          markers: 'circle',
          colours: {
            one: 'orange'
          },
          labels: category,
          meanline: false,
          grid: true,
          grid_colour: "#EEEEEE",
          stroke_width: "2px"
        });
      }
    });
  });
  $('#by_month, #by_week').live('click', function() {
    var by_what, url;
    event.preventDefault();
    if (($(this).attr("id")) === "by_month") {
      by_what = "By Month";
      url = "&by_month=1";
    } else if (($(this).attr("id")) === "by_week") {
      by_what = "By Week";
      url = "&by_week=1";
    }
    return $.ajax({
      url: "Index.php?ajax&admin_transaction=1" + url,
      dataType: "json"
    }).done(function(data) {
      var x_axis, y_axis;
      if (data != null) {
        $('#by_what').html(by_what);
        $('#transaction-graph').html("");
        x_axis = [];
        y_axis = [];
        $.each(data, function(i, item) {
          x_axis.push(item.date);
          return y_axis.push(parseInt(item.counts));
        });
        return new Ico.LineGraph($('#transaction-graph')[0], {
          one: y_axis
        }, {
          markers: 'circle',
          colours: {
            one: 'pink'
          },
          labels: x_axis,
          meanline: false,
          grid: true,
          grid_colour: "#EEEEEE",
          stroke_width: "2px"
        });
      }
    });
  });
  $('#by_city, #by_country').live('click', function() {
    var by_what, url;
    event.preventDefault();
    if (($(this).attr("id")) === "by_city") {
      by_what = "By City";
      url = "&by_city=1";
    } else if (($(this).attr("id")) === "by_country") {
      by_what = "By Country";
      url = "&by_country=1";
    }
    return $.ajax({
      url: "Index.php?ajax&admin_regions_and_territories=1" + url,
      dataType: "json"
    }).done(function(data) {
      var x_axis, y_axis;
      if (data != null) {
        $('#by_what').html(by_what);
        $('#transaction-graph').html("");
        x_axis = [];
        y_axis = [];
        $.each(data, function(i, item) {
          x_axis.push(item.location);
          return y_axis.push(parseInt(item.counts));
        });
        return new Ico.LineGraph($('#transaction-graph')[0], {
          one: y_axis
        }, {
          markers: 'circle',
          colours: {
            one: 'pink'
          },
          labels: x_axis,
          meanline: false,
          grid: true,
          grid_colour: "#EEEEEE",
          stroke_width: "2px"
        });
      }
    });
  });
  $('#by_storage, #by_service').live('click', function() {
    var by_what, url;
    event.preventDefault();
    if (($(this).attr("id")) === "by_storage") {
      by_what = "By Storage";
      url = "&by_storage=1";
    } else if (($(this).attr("id")) === "by_service") {
      by_what = "By Service";
      url = "&by_service=1";
    }
    return $.ajax({
      url: "Index.php?ajax&admin_buys_and_sells=1" + url,
      dataType: "json"
    }).done(function(data) {
      var x_axis, y_axis;
      if (data != null) {
        $('#by_what').html(by_what);
        $('#transaction-graph').html("");
        x_axis = [];
        y_axis = [];
        $.each(data, function(i, item) {
          x_axis.push(item.month);
          return y_axis.push(parseInt(item.amount));
        });
        return new Ico.BarGraph($('#transaction-graph')[0], {
          one: y_axis
        }, {
          colours: {
            one: 'green'
          },
          labels: x_axis,
          meanline: false,
          grid: true,
          grid_colour: "#EEEEEE"
        });
      }
    });
  });
  return true;
});
