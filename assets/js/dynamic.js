// Generated by CoffeeScript 1.3.3

$(function() {
  var dynamicDash, noteAlert, time;
  dynamicDash = function(event) {
    var begin, end, i, n, p, pattern, patterns, _i, _len;
    patterns = event.data.split(",");
    n = $(this).val().toUpperCase().replace(/-/g, '');
    p = "";
    begin = 0;
    end = parseInt(patterns[0]);
    for (i = _i = 0, _len = patterns.length; _i < _len; i = ++_i) {
      pattern = patterns[i];
      if (n.length > end) {
        p += n.substring(begin, end);
        p += "-";
        begin = end;
        end = begin + parseInt(patterns[i + 1]);
      } else {
        break;
      }
    }
    p += n.substring(begin, n.length);
    return $(this).val(p.substring(0, parseInt($(this).attr("maxlength"))));
  };
  $('input[name="phone-number"]').keyup("3,3,4", dynamicDash);
  $('input[name="mcare-number"]').keyup("4,4,4", dynamicDash);
  $('input[name="welfare-number"]').keyup("4,4,4,2", dynamicDash);
  $('input[name="sin-number"]').keyup("3,3,3", dynamicDash);
  $('button#household-create-clear, button#member-create-btn').click(function() {
    return $(this).closest("div.modal-footer").siblings("div.modal-body").find("form :input").each(function() {
      return $(this).val("");
    });
  });
  $("#view-household-form input").prop("disabled", true);
  $('button[name="modify-household-btn"]').click(function() {
    var inputs;
    inputs = $("#view-household-form input");
    if ($(this).attr("class-toggle")) {
      $(this).removeAttr("class-toggle");
      inputs.prop("disabled", false);
      noteAlert("Household Edit Mode", "warning");
    } else {
      $(this).attr("class-toggle", "btn-state");
      $(this).closest("form").submit();
      inputs.prop("disabled", true);
      $.noty.closeAll();
    }
    return $(this).siblings().each(function(index, element) {
      var btn;
      btn = $(element);
      return btn.prop("disabled", btn.prop("disabled") ? false : true);
    });
  });
  noteAlert = function(msg, type) {
    var n;
    n = noty({
      layout: 'bottom',
      type: type,
      text: msg,
      timeout: false,
      animation: {
        open: {
          height: 'toggle'
        },
        close: {
          height: 'toggle'
        },
        easing: 'swing',
        speed: 200
      }
    });
    return n;
  };
  $("form :input").keyup(function() {
    return $(this).val($(this).val().toUpperCase());
  });
  $('form input[name="mcare-number"]').keyup(function() {
    var date, dob, gender, index, input, month, shard, year, _i, _len, _ref;
    input = $(this).val().split('-');
    if (input.length === 3) {
      for (index = _i = 0, _len = input.length; _i < _len; index = ++_i) {
        shard = input[index];
        switch (index) {
          case 1:
            _ref = shard.match(/[\d]{2}/g), year = _ref[0], month = _ref[1];
            gender = month > 12 ? "F" : "M";
            month %= 50;
            break;
          case 2:
            date = shard.match(/[\d]{2}/g)[0];
        }
      }
      dob = "" + month + "-" + date + "-" + year;
      $(this).closest('form').find('input[name="gender"]').val(gender);
      return $(this).closest('form').find('input[name="date-of-birth"]').val(dob);
    }
  });
  time = function() {
    return $('#navbar-time').html(moment().format("hh:mm:ss A", 1000));
  };
  setInterval(time, 1000);
  time();
  $("div.notes").popover({
    'trigger': 'hover'
  });
  return true;
});
